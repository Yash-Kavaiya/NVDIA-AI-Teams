# Customer Support Agent - Architecture Diagram

## High-Level System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER INTERFACE                              â”‚
â”‚                 Next.js 15 + CopilotKit                         â”‚
â”‚                  http://localhost:3000                          â”‚
â”‚                                                                  â”‚
â”‚  Components:                                                     â”‚
â”‚  â€¢ ChatInterface.tsx - Main chat UI                            â”‚
â”‚  â€¢ Sidebar.tsx - Agent selector                                â”‚
â”‚  â€¢ CopilotKit Provider - Agent integration                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ WebSocket / HTTP
                         â”‚ CopilotKit Protocol
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT BACKEND                                â”‚
â”‚              FastAPI + Google ADK + Gemini                      â”‚
â”‚                  http://localhost:8000                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           retail_coordinator (Main Agent)                â”‚  â”‚
â”‚  â”‚                 Gemini 2.5 Flash                         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Responsibilities:                                        â”‚  â”‚
â”‚  â”‚  â€¢ Analyze user requests                                 â”‚  â”‚
â”‚  â”‚  â€¢ Route to appropriate sub-agent                        â”‚  â”‚
â”‚  â”‚  â€¢ Coordinate multi-agent workflows                      â”‚  â”‚
â”‚  â”‚  â€¢ Synthesize responses                                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Available Sub-Agents:                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ” product_search_agent                       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Fashion product search                    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Image/text queries                       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - NVIDIA multimodal embeddings             â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“Š review_text_analysis_agent                 â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Customer review analysis                  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Sentiment scoring                         â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Walmart reviews dataset                   â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“¦ inventory_agent                            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Stock availability                        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Warehouse + retail data                   â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Delivery estimates                        â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ›’ shopping_agent                             â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Cart management                           â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Checkout processing                       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Discount application                      â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ’¬ customer_support_agent â­ NEW!            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Policy Q&A                               â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - RAG retrieval                            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚    - Document citations                        â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CUSTOMER SUPPORT TOOLS MODULE                       â”‚
â”‚                   (tools.py)                                     â”‚
â”‚                                                                  â”‚
â”‚  class CustomerSupportTools:                                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  search_policy_documents(query, top_k)               â”‚      â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚      â”‚
â”‚  â”‚  Inputs:                                              â”‚      â”‚
â”‚  â”‚  â€¢ query: str - Customer question                    â”‚      â”‚
â”‚  â”‚  â€¢ top_k: int - Number of results (default: 5)      â”‚      â”‚
â”‚  â”‚                                                       â”‚      â”‚
â”‚  â”‚  Process:                                             â”‚      â”‚
â”‚  â”‚  1. Generate query embedding                         â”‚      â”‚
â”‚  â”‚  2. Vector search in Qdrant                          â”‚      â”‚
â”‚  â”‚  3. Neural reranking                                 â”‚      â”‚
â”‚  â”‚  4. Format results with metadata                     â”‚      â”‚
â”‚  â”‚                                                       â”‚      â”‚
â”‚  â”‚  Output:                                              â”‚      â”‚
â”‚  â”‚  â€¢ Ranked document chunks                            â”‚      â”‚
â”‚  â”‚  â€¢ Similarity scores                                 â”‚      â”‚
â”‚  â”‚  â€¢ Source citations                                  â”‚      â”‚
â”‚  â”‚  â€¢ Confidence metrics                                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  get_collection_info()                                â”‚      â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚      â”‚
â”‚  â”‚  Returns:                                             â”‚      â”‚
â”‚  â”‚  â€¢ Collection name                                    â”‚      â”‚
â”‚  â”‚  â€¢ Total document chunks                              â”‚      â”‚
â”‚  â”‚  â€¢ Database status                                    â”‚      â”‚
â”‚  â”‚  â€¢ Vector dimensions                                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚
             â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RetrievalPipeline     â”‚  â”‚     QdrantManager            â”‚
â”‚  (retrieval.py)        â”‚  â”‚  (qdrant_manager.py)         â”‚
â”‚                        â”‚  â”‚                              â”‚
â”‚  Responsibilities:     â”‚  â”‚  Responsibilities:           â”‚
â”‚  â€¢ Query embedding     â”‚  â”‚  â€¢ Collection management     â”‚
â”‚  â€¢ Vector search       â”‚  â”‚  â€¢ Vector search             â”‚
â”‚  â€¢ Reranking           â”‚  â”‚  â€¢ Metadata filtering        â”‚
â”‚  â€¢ Result formatting   â”‚  â”‚  â€¢ Point insertion           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NVIDIA API          â”‚  â”‚    Qdrant Vector DB          â”‚
â”‚                        â”‚  â”‚                              â”‚
â”‚  Embedding Model:      â”‚  â”‚  Collection:                 â”‚
â”‚  llama-3.2-nemoretri-  â”‚  â”‚  customer_support_docs       â”‚
â”‚  ever-300m-embed-v2    â”‚  â”‚                              â”‚
â”‚                        â”‚  â”‚  Configuration:              â”‚
â”‚  â€¢ 2048 dimensions     â”‚  â”‚  â€¢ Distance: Cosine          â”‚
â”‚  â€¢ 8192 token context  â”‚  â”‚  â€¢ Vector size: 2048         â”‚
â”‚  â€¢ Input types:        â”‚  â”‚  â€¢ Storage: Persistent       â”‚
â”‚    - query             â”‚  â”‚  â€¢ Port: 6333                â”‚
â”‚    - passage           â”‚  â”‚                              â”‚
â”‚                        â”‚  â”‚  Point Structure:            â”‚
â”‚  Reranker Model:       â”‚  â”‚  â€¢ id: unique int            â”‚
â”‚  llama-3.2-nv-rerank-  â”‚  â”‚  â€¢ vector: [2048 floats]     â”‚
â”‚  qa-1b-v2              â”‚  â”‚  â€¢ payload:                  â”‚
â”‚                        â”‚  â”‚    - text                    â”‚
â”‚  â€¢ Contextual scoring  â”‚  â”‚    - chunk_id                â”‚
â”‚  â€¢ Top-k refinement    â”‚  â”‚    - source_filename         â”‚
â”‚                        â”‚  â”‚    - metadata                â”‚
â”‚                        â”‚  â”‚    - timestamps              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Query to Response

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User Query                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   User: "What is your return policy for electronics?"
   
   â”‚
   â–¼
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Frontend Processing                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   CopilotKit â†’ Send to agent backend
   
   â”‚
   â–¼
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: retail_coordinator Analysis                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   Coordinator: "This is a policy question"
   Decision: Route to customer_support_agent
   
   â”‚
   â–¼
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: customer_support_agent Tool Call                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   Agent calls: search_policy_documents(
     query="What is your return policy for electronics?",
     top_k=5
   )
   
   â”‚
   â–¼
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: CustomerSupportTools Processing                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   5a. Generate Query Embedding
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Input: "What is your return policy for electronics?"
   
   NVIDIA API Request:
   {
     "input": "What is your return policy...",
     "model": "llama-3.2-nemoretriever-300m-embed-v2",
     "input_type": "query",  â† Important!
     "truncate": "NONE"
   }
   
   Output: [0.234, -0.567, 0.891, ... ] (2048 floats)
   
   â”‚
   â–¼
   
   5b. Vector Search in Qdrant
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Query Vector: [2048 floats]
   Collection: customer_support_docs
   Limit: 20 candidates
   Distance: Cosine similarity
   
   Results: 20 document chunks sorted by similarity
   
   Example result:
   {
     "id": 42,
     "score": 0.87,  â† Vector similarity
     "payload": {
       "text": "Electronics return policy: 30 days...",
       "source_filename": "Returns_Policy_2024.pdf",
       "chunk_index": 5,
       ...
     }
   }
   
   â”‚
   â–¼
   
   5c. Neural Reranking
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   NVIDIA Reranker API Request:
   {
     "query": "What is your return policy for electronics?",
     "passages": [
       "Electronics return policy: 30 days...",
       "General return policy...",
       ...
     ],
     "model": "llama-3.2-nv-rerankqa-1b-v2"
   }
   
   Output: Rerank scores for each passage
   [0.92, 0.85, 0.78, 0.71, 0.65, ...]
   
   Top 5 after reranking:
   1. Chunk 42 - Rerank: 0.92, Vector: 0.87
   2. Chunk 15 - Rerank: 0.85, Vector: 0.81
   3. Chunk 28 - Rerank: 0.78, Vector: 0.84
   4. Chunk 7  - Rerank: 0.71, Vector: 0.79
   5. Chunk 33 - Rerank: 0.65, Vector: 0.76
   
   â”‚
   â–¼
   
   5d. Format Results
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Return to agent:
   {
     "success": true,
     "results_count": 5,
     "results": [
       {
         "rank": 1,
         "text": "Electronics can be returned...",
         "source_filename": "Returns_Policy_2024.pdf",
         "chunk_index": 5,
         "similarity_score": 0.87,
         "rerank_score": 0.92,
         "metadata": {...}
       },
       ...
     ]
   }
   
   â”‚
   â–¼
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Agent Response Generation                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   customer_support_agent (Gemini 2.0):
   
   Input:
   â€¢ Original query
   â€¢ Top 5 ranked document chunks
   â€¢ Metadata and scores
   
   Processing:
   â€¢ Analyze retrieved content
   â€¢ Extract relevant information
   â€¢ Generate natural language response
   â€¢ Include citations and confidence
   
   â”‚
   â–¼
   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Response Delivered to User                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   **Return Policy for Electronics**:
   
   According to our Returns and Exchanges Policy (chunk 5):
   "Electronic items may be returned within 30 days of 
   purchase with original packaging, accessories, and proof 
   of purchase. Items must be in new, unused condition."
   
   **Additional Details**:
   - Restocking fee: 15% for opened electronics
   - Warranty items: Different process applies
   - Receipt required for all returns
   
   **Confidence**: 0.92/1.0 (Rerank Score)
   **Source**: Returns_Policy_2024.pdf, Section 3.2
```

## Document Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Ingestion (One-time Setup)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Customer places PDFs in:
customer_support/data/
â”œâ”€â”€ Returns_Policy_2024.pdf
â”œâ”€â”€ Warranty_Guidelines.pdf
â”œâ”€â”€ Shipping_Policy.pdf
â””â”€â”€ Customer_Rights.pdf

â”‚
â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ python main.py process ./data                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Document Loading (load_data.py)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€¢ Scan data/ directory
   â€¢ Detect PDF files
   â€¢ Extract text with Docling
   â€¢ Preserve structure and metadata
   
   Output: Raw text + document metadata

â”‚
â–¼

2. Chunking (chunking.py)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€¢ Split text into chunks
   â€¢ Size: 512 tokens (configurable)
   â€¢ Overlap: 50 tokens (prevents info loss)
   â€¢ Assign chunk IDs and indices
   
   Example chunk:
   {
     "text": "Electronics can be returned...",
     "chunk_id": "returns_policy_chunk_005",
     "chunk_index": 5,
     "source_filename": "Returns_Policy_2024.pdf",
     "source_filepath": "/data/Returns_Policy_2024.pdf",
     "char_count": 487,
     "metadata": {...}
   }
   
   Output: 187 chunks (for 5 documents)

â”‚
â–¼

3. Embedding Generation (embedding.py)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€¢ Batch process chunks (10 per batch)
   â€¢ Call NVIDIA API for embeddings
   â€¢ input_type: "passage" â† For documents
   â€¢ Model: llama-3.2-nemoretriever-300m-embed-v2
   
   For each chunk:
   {
     ...previous_data,
     "embedding": [2048 floats],
     "embedding_dim": 2048
   }
   
   Output: 187 chunks with embeddings

â”‚
â–¼

4. Qdrant Insertion (qdrant_manager.py)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â€¢ Create collection if not exists
   â€¢ Insert points in batches (100)
   â€¢ Store vectors + metadata
   â€¢ Index for fast search
   
   Collection: customer_support_docs
   Points: 187
   Status: âœ… Ready for search

â”‚
â–¼

âœ… Documents indexed and searchable!
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Component Matrix                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Component               â”‚ Depends On           â”‚ Provides
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CustomerSupportTools    â”‚ â€¢ RetrievalPipeline  â”‚ â€¢ search_policy
                        â”‚ â€¢ QdrantManager      â”‚ â€¢ get_info
                        â”‚ â€¢ Config             â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RetrievalPipeline       â”‚ â€¢ EmbeddingGenerator â”‚ â€¢ search()
                        â”‚ â€¢ QdrantManager      â”‚ â€¢ rerank()
                        â”‚ â€¢ NVIDIA API         â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
EmbeddingGenerator      â”‚ â€¢ NVIDIA API         â”‚ â€¢ generate_
                        â”‚ â€¢ OpenAI client      â”‚   embedding()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
QdrantManager           â”‚ â€¢ Qdrant client      â”‚ â€¢ search()
                        â”‚ â€¢ Config             â”‚ â€¢ insert()
                        â”‚                      â”‚ â€¢ get_info()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
customer_support_agent  â”‚ â€¢ CustomerSupport-   â”‚ â€¢ Agent
                        â”‚   Tools              â”‚   instance
                        â”‚ â€¢ Google ADK         â”‚
                        â”‚ â€¢ Gemini API         â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
retail_coordinator      â”‚ â€¢ All sub-agents     â”‚ â€¢ Main
                        â”‚ â€¢ Google ADK         â”‚   coordinator
                        â”‚ â€¢ Gemini API         â”‚
```

## File Structure

```
nvdia-ag-ui/
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ agent.py â† Main coordinator
â”‚   â”‚
â”‚   â””â”€â”€ customer_support_agent/ â­ NEW!
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ agent.py â† Agent definition
â”‚       â”œâ”€â”€ tools.py â† Tool implementations
â”‚       â”œâ”€â”€ test_agent.py â† Test suite
â”‚       â”œâ”€â”€ README.md â† Full documentation
â”‚       â”œâ”€â”€ QUICKSTART.md â† Setup guide
â”‚       â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md â† This summary
â”‚       â””â”€â”€ ARCHITECTURE.md â† Architecture diagrams

customer_support/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ config.py â† Configuration classes
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ retrieval.py â† RetrievalPipeline
â”‚   â”œâ”€â”€ qdrant_manager.py â† QdrantManager
â”‚   â”œâ”€â”€ embedding.py â† EmbeddingGenerator
â”‚   â”œâ”€â”€ chunking.py â† Text chunking
â”‚   â””â”€â”€ load_data.py â† Document loading
â”œâ”€â”€ data/ â† PDF policy documents
â”œâ”€â”€ main.py â† Processing script
â””â”€â”€ requirements.txt â† Python dependencies
```

---

**Legend**:
- ğŸ“„ Documents
- ğŸ” Search operations
- ğŸ’¬ Chat/Communication
- ğŸ“Š Analytics
- â­ New/Featured
- âœ… Ready/Complete
- ğŸ”§ Configuration
